!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t){t.exports={layout:{canvas:{size:600},main:{width:600,height:380,offsetTop:80,offsetLeft:0},navigation:{width:600,height:80,offsetTop:500,offsetLeft:0},tooltip:{height:70,offsetTop:1}},colors:{shadowLight:"#e9e8e8",gridLineLight:"#d0d0d0",gridTextLight:"#8c8c8c",gridLineDark:"#293544",gridTextDark:"#546778",navigationCoverLight:"rgba(234,255,221,0.5)",navigationHandlerLight:"#ddeaf3",navigationCoverDark:"rgba(27,35,46,0.7)",navigationHandlerDark:"#40566b",darkBlue:"#242f3e"},fonts:{regular:{fontFamily:"Arial",fontSize:"12px"},highlight:{fontSize:"16px"}},themes:{day:"day",night:"night"},defaults:{theme:"day",visibleRange:[.25,.5]}}},,,function(t,e){Number.prototype.between=function(t,e,i){const s=Math.min(t,e),o=Math.max(t,e);return i?this>=s&&this<=o:this>s&&this<o},Array.prototype.findClosestValue=function(t){const e=this.map(e=>Math.abs(e-t)),i=Math.min.apply(Math,e);return this[e.indexOf(i)]},Number.prototype.toFixedNumber=function(t){const e=Math.pow(10,t);return Math.round(this*e)/e}},function(t,e,i){"use strict";i.r(e);i(3);var s=i(0),o=class{static sortNumbersAsc(t){return t.slice(0).sort((t,e)=>t-e)}static getMinMax(t){return[(t=this.sortNumbersAsc(t))[0],t[t.length-1]]}static getMax(t){return this.sortNumbersAsc(t)[t.length-1]}static isMouseInsideLayout(t,e,i){const{width:s,height:o,offsetTop:a,offsetLeft:n}=i;return t.between(n,n+s)&&e.between(a,a+o)}static formatMonth(t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t]}static formatWeekday(t){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t]}static calculateLayoutWidth(t){return Math.min(t,document.getElementById("charts").offsetWidth)}static formatNumber(t){const e=Math.log(t)/Math.log(1e3)|0;return+(t/Math.pow(1e3,e)).toFixed(2)+("kMGTPEZY"[e-1]||"")}};var a=class{constructor(t){this.data=t,this.animationTime=5,this.targetY=[],this.targetVisibility=!0,this.opacity=1}draw(t){this._needMoveAnimation()&&this._animateTranslation(),this._needFadeAnimation()&&this._animateFade(),this._drawLine(t)}updatePositions(t,e){this.data.positionsX=t.slice(0),this.targetY=e.slice(0)}updateVisibility(t){this.targetVisibility=t}_animateTranslation(){let t=!1;this.data.positionsY=this.data.positionsY.map((e,i)=>{const s=this.targetY[i]-e;return 0!==s&&(t=!0,e=this._recalculatePosition(e,s)),e}),t||(this.targetY=[])}_animateFade(){this.targetVisibility?this.opacity+=.1:this.opacity-=.1,this.opacity=Math.min(this.opacity,1),this.opacity=Math.max(this.opacity,0),this.opacity.between(0,1)||(this.data.visible=this.targetVisibility)}_recalculatePosition(t,e){let i=e/this.animationTime;return e>0?i=Math.min(Math.ceil(i),e):e<0&&(i=Math.max(Math.floor(i),e)),t+=i}_needMoveAnimation(){return this.targetY.length}_needFadeAnimation(){return this.data.visible!==this.targetVisibility}_drawLine(t){t.save(),t.lineWidth=2,t.strokeStyle=this.data.color,t.globalAlpha=this.opacity,t.beginPath();const e=this.data.positionsX[0],i=this.data.positionsY[0];t.moveTo(e,i);for(let e=1;e<this.data.valuesCount;e++){const i=this.data.positionsX[e],s=this.data.positionsY[e];t.lineTo(i,s)}t.stroke(),t.restore()}};const n={visibleRangeChange:"VISIBLE_RANGE_CHANGE",toggleTheme:"TOGGLE_THEME"};const h=new class{constructor(){this.state={visibleRanges:[],theme:s.defaults.theme},this.listeners={}}subscribe(t,e){this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)}switchTheme(t){this.state.theme!==t&&(this.state.theme=t,this._dispatch(n.toggleTheme,this.getTheme()))}updateVisibleRange(t,e,i){this.state.visibleRanges[t]=[e,i],this._dispatch(n.visibleRangeChange,t,this.getVisibleRange(t))}getVisibleRange(t){return this.state.visibleRanges[t]||this._setDefaultRange(t),this.state.visibleRanges[t].slice(0)}getTheme(){return this.state.theme}_dispatch(t){this.listeners[t]=this.listeners[t]||[],this.listeners[t].forEach(t=>t(...arguments))}_setDefaultRange(t){this.state.visibleRanges[t]=s.defaults.visibleRange}};var r=class{constructor(t,e){this.index=t,this.color=e,this.visible=!0,this.x=null,this.y=null,this.background="white",this._bindEvents()}_bindEvents(){h.subscribe(n.toggleTheme,(t,e)=>this._onChangeTheme(e))}_onChangeTheme(t){t===s.themes.night?this.background=s.colors.darkBlue:this.background="white"}setPosition(t,e){this.x=t||null,this.y=e||null}updateVisibility(t){this.visible=t}draw(t){this.x>0&&this.y>0&&this.visible&&(t.save(),t.strokeStyle=this.color,t.fillStyle=this.background,t.lineWidth=4,t.beginPath(),t.arc(this.x,this.y,5,0,2*Math.PI),t.stroke(),t.fill(),t.restore())}};var l=class{constructor(t,e,i,o,a){this.minSpaceBetweenVerticalLines=80,this.animationTime=5,this.layout=a,this.positionsX=t,this.captionsX=e,this.originalPositionsY=i.slice(0),this.positionsY=i,this.captionsY=o,this.horizontalLine={offsetLeft:this.layout.offsetLeft+10,length:this.layout.width-20},this.verticalLine={offsetTop:this.layout.offsetTop-20,length:this.layout.height+20},this.xAxisCaptionPositionY=this.layout.offsetTop+this.layout.height+20,this.opacititesX=this.calculateOpacitiesX(),this.hoverPositionX=null,this.targetOpacititesX=[],this.targetPositionsY=[],this.newPositionsY=[],this.newTargetPositionsY=[],this.newCaptionsY=[],this.opacityY=1,this.targetOpacityY=1,this.newOpacityY=0,this.newTargetOpacityY=0,this.textColor=s.colors.gridTextLight,this.lineColor=s.colors.gridLineLight,this._bindEvents()}_bindEvents(){h.subscribe(n.toggleTheme,(t,e)=>this._onChangeTheme(e))}_onChangeTheme(t){t===s.themes.night?(this.textColor=s.colors.gridTextDark,this.lineColor=s.colors.gridLineDark):(this.textColor=s.colors.gridTextLight,this.lineColor=s.colors.gridLineLight)}calculateOpacitiesX(){let t=Math.ceil(this.minSpaceBetweenVerticalLines/(this.positionsX[1]-this.positionsX[0]));t=Math.pow(2,Math.round(Math.sqrt(t)));const e=Array(this.positionsX.length).fill(0);for(let i=0;i<this.positionsX.length;i+=t)e[i]=1;return e}updatePositions(t,e){this.positionsX=t.slice(0),this.targetOpacititesX=this.calculateOpacitiesX(),this.newTargetPositionsY=this.originalPositionsY.slice(0),this.targetOpacityY=0,this.newTargetOpacityY=1,this.newCaptionsY[1]!==e[1]&&(this.newCaptionsY=e.slice(0),this.captionsY[1]>e[1]?(this.targetPositionsY=this.originalPositionsY.map(t=>t-1.1*(this.originalPositionsY[0]-t)),this.newPositionsY=this.originalPositionsY.map(t=>t+.9*(this.originalPositionsY[0]-t))):this.captionsY[1]<e[1]&&(this.targetPositionsY=this.originalPositionsY.map(t=>t+.9*(this.originalPositionsY[0]-t)),this.newPositionsY=this.originalPositionsY.map(t=>t-1.1*(this.originalPositionsY[0]-t))))}setHoverPositionX(t){this.hoverPositionX=t}draw(t){this._needAnimationX()&&this._animateX(),this._needAnimationY()&&(this._animateY(),this._drawGridY(t,this.newPositionsY,this.newCaptionsY,this.newOpacityY)),this._drawGridY(t,this.positionsY,this.captionsY,this.opacityY),this._drawGridX(t,this.positionsX,this.captionsX,this.opacititesX,!0),null!==this.hoverPositionX&&this._drawVerticalGridLine(t,this.hoverPositionX)}_animateX(){this._animateOpacity("opacititesX","targetOpacititesX")}_animateY(){let t=!1;this.positionsY=this.positionsY.map((e,i)=>{const s=this.targetPositionsY[i]-e;let o=s/this.animationTime;return 0!==s&&(t=!0,s>0?o=Math.min(Math.ceil(o),s):s<0&&(o=Math.max(Math.floor(o),s)),e+=o),e}),this.newPositionsY=this.newPositionsY.map((e,i)=>{const s=this.newTargetPositionsY[i]-e;let o=s/this.animationTime;return 0!==s&&(t=!0,s>0?o=Math.min(Math.ceil(o),s):s<0&&(o=Math.max(Math.floor(o),s)),e+=o),e});let e=this.targetOpacityY-this.opacityY,i=(e/this.animationTime).toFixedNumber(1);0===i&&(this.opacityY=Math.round(this.opacityY),e=0),0!==e&&(t=!0,e>0?i=Math.min(i,e):e<0&&(i=Math.max(i,e)),this.opacityY+=i);let s=this.newTargetOpacityY-this.newOpacityY,o=(s/this.animationTime).toFixedNumber(1);0===o&&(this.newOpacityY=Math.round(this.newOpacityY),s=0),0!==s&&(t=!0,e>0?o=Math.min(o,e):e<0&&(o=Math.max(o,e)),this.newOpacityY+=o),t||(this.positionsY=this.newTargetPositionsY.slice(0),this.captionsY=this.newCaptionsY.slice(0),this.opacityY=this.newOpacityY,this.targetPositionsY=[],this.newPositionsY=[],this.newTargetPositionsY=[])}_animateOpacity(t,e){let i=!1;this[t]=this[t].map((t,s)=>{let o=this[e][s]-t,a=(o/this.animationTime).toFixedNumber(2);return 0===a&&(t=Math.round(t),o=0),0!==o&&(i=!0,o>0?a=Math.min(a,o):o<0&&(a=Math.max(a,o)),t+=a),t}),i||(this[e]=[])}_needAnimationX(){return this.targetOpacititesX.length}_needAnimationY(){return this.targetPositionsY.length}_drawGridX(t,e,i,s,o=!1){t.save();for(let a=0;a<=e.length;a++)t.globalAlpha=s[a],o||this._drawVerticalGridLine(t,e[a]),this._drawGridText(t,i[a],e[a],this.xAxisCaptionPositionY,"center");t.restore()}_drawGridY(t,e,i,s){t.save();for(let o=0;o<e.length;o++)t.globalAlpha=s,this._drawHorizontalGridLine(t,e[o]),this._drawGridText(t,i[o],this.horizontalLine.offsetLeft,e[o]-10,"left");t.restore()}_drawHorizontalGridLine(t,e){t.fillStyle=this.lineColor,t.fillRect(this.horizontalLine.offsetLeft,e-1,this.horizontalLine.length,1)}_drawVerticalGridLine(t,e){t.fillStyle=this.lineColor,t.fillRect(e,this.verticalLine.offsetTop,1,this.verticalLine.length)}_drawGridText(t,e,i,o,a){t.fillStyle=this.textColor,t.font=s.fonts.regular.fontSize+" "+s.fonts.regular.fontFamily,t.lineWidth=1,t.textAlign=a,t.fillText(e,i,o)}};var c=class{constructor(t,e,i){this.layout=i,this.layout.width=o.calculateLayoutWidth(i.width);const[s,a]=o.getMinMax(t);this.valuesX=t,this.valuesY=e,this.minX=s,this.maxX=a,this.minY=0,this.maxY=o.getMax(e),this.deltaX=this.maxX-this.minX,this.scaleX=1,this.percentsOffsetX=0,this.translateX=0,this.yAxisLinesCount=6}setVisibleRange(t){const[e,i]=t,s=i-e;this.scaleX=1/s,this.percentsOffsetX=e,this.translateX=e*this.layout.width*this.scaleX}setMaxY(t){this.maxY=this._calculateMaxY(t),this.stepY=this._calculateAxisYStep(this.maxY)}coordsToPxPosition(t,e){return[this.xCoordToXPxPosition(t),this.yCoordToYPxPosition(e)]}xCoordToXPxPosition(t){return this._coordToPxPosition(t,this.minX,this.deltaX,this.layout.width,this.layout.offsetLeft-this.translateX,this.scaleX)}yCoordToYPxPosition(t){return t=this.maxY-t+this.minY,this._coordToPxPosition(t,this.minY,this.maxY,this.layout.height,this.layout.offsetTop)}pxPositionXToValueX(t){const e=this._pxPositionToCoord(t,this.minX,this.deltaX,this.layout.width,this.percentsOffsetX,this.scaleX);return this.valuesX.findClosestValue(e)}_calculateAxisYStep(t){return Math.ceil(t/this.yAxisLinesCount)}_calculateMaxY(t){const e=t.toString().length,i=Math.pow(10,e-1)/2;return Math.ceil(t/i)*i}_coordToPxPosition(t,e,i,s,o,a=1){const n=(t-e)/i;let h=Math.round(n*s);return h*=a,h+=o}_pxPositionToCoord(t,e,i,s,o,a){let n=t/s;return n/=a,n+=o,Math.round(n*i)+e}};var d=class{constructor(t){this.chartsData=t,this.converter=null,this.visibleRange=[0,1],this.visibleCharts=[]}setLayout(t){this.converter=new c(this.getAllValuesX(),this.getAllValuesY(),t)}setVisibleRange(t){this.visibleRange=t,this.converter.setVisibleRange(t),this.converter.setMaxY(this.getMaxVisibleValueY())}getNormalizedChartsData(){const t=[];for(let e=0;e<this.getChartsAmount();e++)t.push(this.prepareChartData(e));return t}getBaseName(){return"Chart "+(this.chartsData.index+1)}getNames(){const t=[];return this.chartsData.columns.forEach(e=>{const i=e[0];this.chartsData.names[i]&&t.push(this.chartsData.names[i])}),t}getColors(){const t=[];return this.chartsData.columns.forEach(e=>{const i=e[0];this.chartsData.colors[i]&&t.push(this.chartsData.colors[i])}),t}getAllValuesX(){return this.getValuesInColumn(this.chartsData.types.x)}getAllValuesY(){const t=this.chartsData.columns.filter(t=>t[0]!==this.chartsData.types.x);let e=[];return t.forEach(t=>e=e.concat(t.slice(1))),e}getMaxVisibleValueY(){const[t,e]=this.visibleRange;let i=null;return this.getNormalizedChartsData().filter(t=>t.visible).forEach(s=>{const a=Math.floor(s.valuesY.length*t),n=Math.ceil(s.valuesY.length*e),h=s.valuesY.slice(a,n),r=o.getMax(h);i=i?Math.max(i,r):r}),i||(i=o.getMax(this.getAllValuesY())),i}getPositionsOnAxisX(){return this.getAllValuesX().map(t=>this.converter.xCoordToXPxPosition(t))}getPositionsOnAxisY(){return this.getCaptionsOnAxisY().map(t=>this.converter.yCoordToYPxPosition(t))}getCaptionsOnAxisX(){return this.getAllValuesX().map(t=>{const e=new Date(t);return o.formatMonth(e.getMonth())+" "+e.getDate()})}getCaptionsOnAxisY(){const t=[];for(let e=this.converter.minY;e<this.converter.maxY;e+=this.converter.stepY)t.push(e);return t}getValuesInColumn(t){return this.chartsData.columns.filter(e=>t===e[0])[0].slice(1)}getChartsAmount(){return this.chartsData.columns.length-1}prepareChartData(t){const e=`y${t}`,i=this.getAllValuesX(),s=this.getValuesInColumn(e),o=i.length,[a,n]=this.calculatePositions(i,s,o);return{index:t,visible:this.visibleCharts.indexOf(t)<0,type:this.chartsData.types[e],color:this.chartsData.colors[e],name:this.chartsData.names[e],valuesCount:o,valuesX:i,valuesY:s,positionsX:a,positionsY:n}}calculatePositions(t,e,i){const s=[],o=[];for(let a=0;a<i;a++){const i=t[a],n=e[a],[h,r]=this.converter.coordsToPxPosition(i,n);s.push(h),o.push(r)}return[s,o]}getHoverPosition(t,e){let i=null;if(o.isMouseInsideLayout(t,e,this.converter.layout)){const e=this.converter.pxPositionXToValueX(t);i=this.converter.valuesX.indexOf(e)}return i}toggleChart(t){this.visibleCharts[t]=this.visibleCharts.indexOf(t)<0?t:null,this.converter.setMaxY(this.getMaxVisibleValueY())}};var u=class{constructor(t){this.offsetTop=s.layout.tooltip.offsetTop,this.position=null,this.captionX=null,this.captionsY=[],this.pixelsPerChar=10,this.minColumnWidth=70,this.background="white",this.dateTextColor="black",this.shadowColor=s.colors.shadowLight,this.updateChartsData(t),this._bindEvents()}_bindEvents(){h.subscribe(n.toggleTheme,(t,e)=>this._onChangeTheme(e))}_onChangeTheme(t){t===s.themes.night?(this.background=s.colors.darkBlue,this.dateTextColor="white",this.shadowColor="black"):(this.background="white",this.dateTextColor="black",this.shadowColor=s.colors.shadowLight)}updateChartsData(t){this.chartsData=t,this.chartsDataVisible=t.filter(t=>t.visible),this.calculateTooltipSize()}calculateTooltipSize(){this.width=0,this.chartsDataVisible.forEach(t=>{let e=t.valuesY[t.valuesY.length-1].toString().length*this.pixelsPerChar;e=Math.max(e,this.minColumnWidth),this.width+=e}),this.halfWidth=this.width/2,this.columnWidth=this.width/this.chartsDataVisible.length}setHover(t,e,i){this.position=t,this.captionX=e,this.captionsY=i}draw(t){if(null!==this.position){let e=this.position-this.halfWidth;e=Math.max(1,e),e=Math.min(e,t.canvas.offsetWidth-this.width-1),this._drawRect(t,e),this._drawText(t,e+10,this.captionX)}}_drawRect(t,e){t.save(),t.strokeStyle=s.colors.greyLine,t.fillStyle=this.background,t.shadowColor=this.shadowColor,t.shadowOffsetY=1,t.shadowBlur=1,t.beginPath(),t.rect(e,this.offsetTop,this.width,s.layout.tooltip.height),t.stroke(),t.fill(),t.restore()}_drawText(t,e,i){let s=this.offsetTop+20;this._drawDate(t,e,s,i),s+=25;let o=0;this.captionsY.forEach((i,a)=>{const n=this.chartsData[a];n.visible&&(this._drawValue(t,e+o,s,i,n.color),this._drawChartName(t,e+o,s+15,n.name,n.color),o+=this.columnWidth)})}_drawDate(t,e,i,o){t.save(),t.fillStyle=this.dateTextColor,t.font=s.fonts.highlight.fontSize+" "+s.fonts.regular.fontFamily,t.fillText(o,e,i),t.restore()}_drawValue(t,e,i,o,a){t.save(),t.fillStyle=a,t.font="bold "+s.fonts.highlight.fontSize+" "+s.fonts.regular.fontFamily,t.fillText(o,e,i),t.restore()}_drawChartName(t,e,i,o,a){t.save(),t.fillStyle=a,t.font=s.fonts.regular.fontSize+" "+s.fonts.regular.fontFamily,t.fillText(o,e,i),t.restore()}};var g=class{constructor(t){const e=t.getBoundingClientRect();this.canvas=t,this.offsetTop=e.top,this.offsetLeft=e.left,this.dataManager=null,this.charts=[],this.hovers=[],this.grid=null,this.tooltip=null}setChartsData(t){return this.dataManager=new d(t),this}setLayout(t){return this.dataManager.setLayout(t),this}setVisibleRange(t){return this.dataManager.setVisibleRange(t),this.updateChartsPositions(),this.grid&&this.updateGrid(),this._hideHover(),this}createCharts(){return this.dataManager.getNormalizedChartsData().forEach(t=>{switch(t.type){case"line":const e=new a(t);this.charts.push(e);break;default:console.error(`unsupported chart type ${type}`)}}),this.charts}updateChartsPositions(){const t=this.dataManager.getNormalizedChartsData();this.charts.filter(t=>"function"==typeof t.updatePositions).forEach(e=>{const{positionsX:i,positionsY:s}=t[e.data.index];e.updatePositions(i,s)})}updateChartsVisibility(){const t=this.dataManager.getNormalizedChartsData();this.charts.forEach(e=>{const{visible:i}=t[e.data.index];e.updateVisibility(i)}),this.hovers.forEach(e=>{const{visible:i}=t[e.index];e.updateVisibility(i)}),this.tooltip&&this.tooltip.updateChartsData(t),this.updateChartsPositions()}updateGrid(){this.grid.updatePositions(this.dataManager.getPositionsOnAxisX(),this.dataManager.getCaptionsOnAxisY())}createGrid(){return this.grid=new l(this.dataManager.getPositionsOnAxisX(),this.dataManager.getCaptionsOnAxisX(),this.dataManager.getPositionsOnAxisY(),this.dataManager.getCaptionsOnAxisY(),this.dataManager.converter.layout),this.grid}createTooltip(){return this.tooltip=new u(this.charts.map(t=>t.data)),this.tooltip}toggleChart(t){this.dataManager.toggleChart(t),this.updateChartsVisibility(),this.grid&&this.updateGrid()}createHovers(){return this.dataManager.getNormalizedChartsData().forEach(t=>{switch(t.type){case"line":this.hovers.push(new r(t.index,t.color))}}),this._bindHoverEvents(),this.hovers}_bindHoverEvents(){this.canvas.addEventListener("mousemove",t=>this._onMouseMove(t)),this.canvas.addEventListener("mouseleave",t=>this._onMouseLeave(t))}_onMouseMove(t){const e=Math.round(t.clientX-this.offsetLeft+window.scrollX),i=Math.round(t.clientY-this.offsetTop+window.scrollY);this._handleMouseMove(e,i)}_onMouseLeave(){this._hideHover()}_hideHover(){this._handleMouseMove(-100,-100)}_handleMouseMove(t,e){const i=this.dataManager.getHoverPosition(t,e),s=this.dataManager.getAllValuesX()[i],a=this.dataManager.converter.xCoordToXPxPosition(s),n=[];if(this.charts.forEach(t=>{const e=t.data.valuesY[i];n.push(e)}),this.hovers.forEach((t,e)=>{const i=n[e],s=this.dataManager.converter.yCoordToYPxPosition(i);t.setPosition(a,s)}),this.grid&&this.grid.setHoverPositionX(a),this.tooltip){const t=new Date(s),e=o.formatWeekday(t.getDay())+", "+o.formatMonth(t.getMonth())+" "+t.getDate();this.tooltip.setHover(a,e,n)}}},m=class{constructor(t,e){this.chartsFactory=new g(t.canvas).setChartsData(e).setLayout(s.layout.main).setVisibleRange(h.getVisibleRange()),this.ctx=t,this.charts=this.chartsFactory.createCharts(),this.hovers=this.chartsFactory.createHovers(),this.grid=this.chartsFactory.createGrid(),this.tooltip=this.chartsFactory.createTooltip(),this.index=e.index,this._bindEvents()}draw(){this.grid.draw(this.ctx),this.charts.forEach(t=>t.draw(this.ctx)),this.hovers.forEach(t=>t.draw(this.ctx)),this.tooltip.draw(this.ctx)}toggleChart(t){this.chartsFactory.toggleChart(t)}_bindEvents(){h.subscribe(n.visibleRangeChange,(t,e,i)=>{e===this.index&&this.chartsFactory.setVisibleRange(i)})}},v=class{constructor(t,e){const[i,o]=h.getVisibleRange();this.ctx=t,this.chartsFactory=new g(this.ctx.canvas).setChartsData(e).setLayout(s.layout.navigation),this.charts=this.chartsFactory.createCharts(),this.rangeFromPx=this._convertRangePercentsToPx(i),this.rangeToPx=this._convertRangePercentsToPx(o),this.prevRangeMoveMouseX=null,this.deltaRangeMoveMouseX=0,this.mouseBorderWidth=40,this.mouseBorderWidthHalf=Math.round(this.mouseBorderWidth/2),this.prevLeftBorderMoveMouseX=null,this.prevRightBorderMoveMouseX=null,this.deltaLeftBorderMoveMouseX=0,this.deltaRightBorderMoveMouseX=0,this.minVisibleRangeDelta=60,this.index=e.index,this.mouseX=null,this.mouseY=null,this.background="white",this.coverColor=s.colors.navigationCoverLight,this.handlerColor=s.colors.navigationHandlerLight,this._bindEvents()}_bindEvents(){this.clickAndMoveMouseHandler=(t=>this._onClickAndMoveMouse(t.clientX,t.clientY)),this.tapAndSwipeHandler=(t=>this._onClickAndMoveMouse(t.touches[0].clientX,t.touches[0].clientY)),this.ctx.canvas.addEventListener("mousedown",t=>this._onMouseDown(t.clientX,t.clientY),!1),this.ctx.canvas.addEventListener("mousemove",t=>this._onMouseMove(t.clientX,t.clientY),!1),this.ctx.canvas.addEventListener("mouseleave",()=>this._onMouseLeave(),!1),document.addEventListener("mouseup",()=>this._onMouseUp(),!1),this.ctx.canvas.addEventListener("touchstart",t=>this._onMouseDown(t.touches[0].clientX,t.touches[0].clientY),!1),this.ctx.canvas.addEventListener("touchend",()=>this._onMouseUp(),!1),this.ctx.canvas.addEventListener("touchcancel",()=>this._onMouseUp(),!1),h.subscribe(n.toggleTheme,(t,e)=>this._onChangeTheme(e))}_onChangeTheme(t){t===s.themes.night?(this.coverColor=s.colors.navigationCoverDark,this.handlerColor=s.colors.navigationHandlerDark,this.background=s.colors.darkBlue):(this.coverColor=s.colors.navigationCoverLight,this.handlerColor=s.colors.navigationHandlerLight,this.background="white")}_onMouseDown(t,e){document.addEventListener("mousemove",this.clickAndMoveMouseHandler,!1),document.addEventListener("touchmove",this.tapAndSwipeHandler,!1),this._actualizeMouseLocalPosition(t,e),this.prevLeftBorderMoveMouseX=this._isMouseOnLeftRangeBorder()?this.mouseX:null,this.prevRightBorderMoveMouseX=this._isMouseOnRightRangeBorder()?this.mouseX:null,this.prevLeftBorderMoveMouseX||this.prevRightBorderMoveMouseX||(this.prevRangeMoveMouseX=this._isMouseOnRange()?this.mouseX:null)}_onMouseMove(t,e){this._actualizeMouseLocalPosition(t,e),document.body.style.cursor=this._isMouseOnRangeBorder()?"ew-resize":this._isMouseOnRange()?"grab":"default"}_onClickAndMoveMouse(t,e){const i=this._isMouseOutsideOfPage(t,e);this._actualizeMouseLocalPosition(t,e),this.prevRangeMoveMouseX&&(this.deltaRangeMoveMouseX=this.mouseX-this.prevRangeMoveMouseX,this._handleRangeMove(),i||(this.prevRangeMoveMouseX=this.mouseX)),this.prevLeftBorderMoveMouseX&&(this.deltaLeftBorderMoveMouseX=this.mouseX-this.prevLeftBorderMoveMouseX,this._handleRangeLeftBorderMove(),i||(this.prevLeftBorderMoveMouseX=this.mouseX)),this.prevRightBorderMoveMouseX&&(this.deltaRightBorderMoveMouseX=this.mouseX-this.prevRightBorderMoveMouseX,this._handleRangeRightBorderMove(),i||(this.prevRightBorderMoveMouseX=this.mouseX))}_onMouseLeave(){document.body.style.cursor="default"}_onMouseUp(){document.removeEventListener("mousemove",this.clickAndMoveMouseHandler,!1),document.removeEventListener("touchmove",this.tapAndSwipeHandler,!1),this.prevRangeMoveMouseX=null,this.prevLeftBorderMoveMouseX=null,this.prevRightBorderMoveMouseX=null}_handleRangeMove(){let t;document.body.style.cursor="grabbing";let e=!1;this.deltaRangeMoveMouseX>0?(t=this._getIncreasingDelta(this.deltaRangeMoveMouseX),e=!0):this.deltaRangeMoveMouseX<0&&(t=this._getDecreasingDelta(this.deltaRangeMoveMouseX),e=!0),e&&(this.rangeFromPx+=t,this.rangeToPx+=t,this._updateRange())}_handleRangeLeftBorderMove(){let t,e=!1;this.deltaLeftBorderMoveMouseX>0?(t=Math.min(this.deltaLeftBorderMoveMouseX,this.rangeToPx-this.minVisibleRangeDelta-this.rangeFromPx),e=!0):this.deltaLeftBorderMoveMouseX<0&&(t=this._getDecreasingDelta(this.deltaLeftBorderMoveMouseX),e=!0),e&&(this.rangeFromPx+=t,this._updateRange())}_handleRangeRightBorderMove(){let t,e=!1;this.deltaRightBorderMoveMouseX>0?(t=this._getIncreasingDelta(this.deltaRightBorderMoveMouseX),e=!0):this.deltaRightBorderMoveMouseX<0&&(t=Math.max(this.deltaRightBorderMoveMouseX,-(this.rangeToPx-this.rangeFromPx-this.minVisibleRangeDelta)),e=!0),e&&(this.rangeToPx+=t,this._updateRange())}_updateRange(){const t=this._convertRangePxToPercents(this.rangeFromPx),e=this._convertRangePxToPercents(this.rangeToPx);h.updateVisibleRange(this.index,t,e)}_isMouseOnRange(){return this.mouseX.between(this.rangeFromPx,this.rangeToPx)&&this._isMouseYInsideLayout()}_isMouseOnRangeBorder(){return this._isMouseOnLeftRangeBorder()||this._isMouseOnRightRangeBorder()}_isMouseOnLeftRangeBorder(){return this.mouseX.between(this.rangeFromPx-this.mouseBorderWidthHalf,this.rangeFromPx+this.mouseBorderWidthHalf)&&this._isMouseYInsideLayout()}_isMouseOnRightRangeBorder(){return this.mouseX.between(this.rangeToPx-this.mouseBorderWidthHalf,this.rangeToPx+this.mouseBorderWidthHalf)&&this._isMouseYInsideLayout()}_isMouseOutsideOfPage(t,e){return e<=0||t<=0||t>=window.innerWidth||e>=window.innerHeight}_isMouseYInsideLayout(){const t=this.ctx.canvas.getBoundingClientRect();return this.mouseY.between(s.layout.navigation.offsetTop,t.height)}_getIncreasingDelta(t){return Math.min(s.layout.navigation.width-this.rangeToPx,t)}_getDecreasingDelta(t){return Math.max(-this.rangeFromPx,t)}_convertRangePercentsToPx(t){return t*s.layout.navigation.width}_convertRangePxToPercents(t){return t/s.layout.navigation.width}_actualizeMouseLocalPosition(t,e){const i=this.ctx.canvas.getBoundingClientRect();this.mouseX=Math.round(t-i.left),this.mouseY=Math.round(e-i.top)}draw(){this.ctx.save(),this._drawHandler(),this.charts.forEach(t=>t.draw(this.ctx)),this._drawCover(),this.ctx.restore()}_drawHandler(){const t=this.rangeFromPx,e=s.layout.navigation.offsetTop,i=this.rangeToPx-this.rangeFromPx,o=s.layout.navigation.height;this.ctx.fillStyle=this.handlerColor,this.ctx.fillRect(t,e,i,o),this.ctx.fillStyle=this.background,this.ctx.fillRect(t+5,e+3,i-10,o-6)}_drawCover(){const t=s.layout.navigation.width,e=s.layout.navigation.offsetLeft;this.drawCoverPart(e,this.rangeFromPx),this.drawCoverPart(e+this.rangeToPx,t-this.rangeToPx)}drawCoverPart(t,e){this.ctx.fillStyle=this.coverColor,this.ctx.fillRect(t,s.layout.navigation.offsetTop,e,s.layout.navigation.height)}toggleChart(t){this.chartsFactory.toggleChart(t)}};var p=class{constructor(t){this._init(t),this._bindEvents()}_init(t){const e=new d(t),i=e.getBaseName(),s=e.getNames(),o=e.getColors(),a=e.getChartsAmount(),n=this._createNavButtons(t,i);this._createChartTitle(i);const h=this._createCanvas(),r=this._createChartButtons(s,o,a);this.ctx=h,this.main=new m(h,t),this.navigation=new v(h,t),this.chartButtons=r,this.navButton=n}draw(){this._clear(),this.main.draw(),this.navigation.draw()}_createNavButtons(t,e){const i=document.createElement("button");return i.innerHTML=e,document.getElementById("leftCol").appendChild(i),i}_createCanvas(){const t=document.createElement("canvas"),e=o.calculateLayoutWidth(s.layout.canvas.size),i=s.layout.canvas.size,a=2*e,n=2*i;t.width=a,t.height=n,t.style.width=e+"px",t.style.height=i+"px";const h=t.getContext("2d");return h.scale(2,2),document.getElementById("charts").appendChild(t),h}_createChartTitle(t){const e=document.createElement("h1");e.innerHTML=t,document.getElementById("charts").appendChild(e)}_createChartButtons(t,e,i){const s=[],o=document.createElement("div");o.className="chart-buttons",document.getElementById("charts").appendChild(o);for(let a=0;a<i;a++){const i=t[a],n=e[a],h=document.createElement("button");h.className="chart-buttons__button active";const r=document.createElement("span");r.className="chart-buttons__button__checkbox",r.style.backgroundColor=n,h.appendChild(r);const l=document.createElement("span");l.innerHTML=i,h.appendChild(l),o.appendChild(h),h.addEventListener("click",()=>h.classList.toggle("active"),!1),s.push(h)}return s}_clear(){this.ctx.clearRect(0,0,this.ctx.canvas.offsetWidth,this.ctx.canvas.offsetHeight)}_bindEvents(){this.chartButtons.forEach((t,e)=>{t.addEventListener("click",()=>this._toggleChart(e),!1)}),this.navButton.addEventListener("click",()=>this._scrollToChart(),!1)}_toggleChart(t){this.main.toggleChart(t),this.navigation.toggleChart(t)}_scrollToChart(){this.ctx.canvas.scrollIntoView({behavior:"smooth"})}};new class{constructor(t){this.theme=h.getTheme(),this.themes=s.themes,this.widgets=[],t.forEach((t,e)=>{t.index=e,this.widgets.push(new p(t))}),this.switchThemeButton=this._createSwitchThemeButton(),this.switchThemeButtonMobile=this._createSwitchThemeButtonMobile(),this._actualizeSwitchModeButtonText(),this._bindEvents(),window.requestAnimationFrame(()=>this.draw())}_bindEvents(){this.switchThemeButton.addEventListener("click",()=>this._switchMode(),!1),this.switchThemeButtonMobile.addEventListener("click",()=>this._switchMode(),!1)}draw(){this.widgets.forEach(t=>t.draw()),window.requestAnimationFrame(()=>this.draw())}_createSwitchThemeButton(){const t=document.createElement("button");return document.getElementById("leftCol").appendChild(t),t}_createSwitchThemeButtonMobile(){const t=document.createElement("button");return document.getElementById("switchThemeButtonHolder").appendChild(t),t}_switchMode(){this.theme===this.themes.day?this.theme=this.themes.night:this.theme=this.themes.day,h.switchTheme(this.theme),this._actualizeBodyClass(),this._actualizeSwitchModeButtonText()}_actualizeBodyClass(){document.body.classList.remove(this.themes.day+"-theme"),document.body.classList.remove(this.themes.night+"-theme"),document.body.classList.add(this.theme+"-theme")}_actualizeSwitchModeButtonText(){const t=this.theme===this.themes.day?this.themes.night:this.themes.day;this.switchThemeButton.innerText=`Switch to ${t} mode`,this.switchThemeButtonMobile.innerText=this.switchThemeButton.innerText}}(window.DATA)}]);